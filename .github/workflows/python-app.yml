name: Risk Engine Proof Run

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  run-engine:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # -------------------------
      # v0.1 proof run (unchanged)
      # -------------------------
      - name: Proof run (observer-only)
        run: |
          python main.py

      # -------------------------
      # v0.2 scenarios (Phase 6â€“7)
      # -------------------------
      - name: Scenario: stable
        run: |
          RISK_SCENARIO=stable RISK_TURNS=10 RISK_SEED=1337 python main.py

      - name: Scenario: stressed
        run: |
          RISK_SCENARIO=stressed RISK_TURNS=10 RISK_SEED=1337 python main.py

      - name: Scenario: collapse (expected)
        continue-on-error: true
        run: |
          RISK_SCENARIO=collapse RISK_TURNS=10 RISK_SEED=1337 python main.py

      - name: Assert collapse occurred
        run: |
          grep -R "COLLAPSE" logs || (echo "Expected COLLAPSE not found" && exit 1)
